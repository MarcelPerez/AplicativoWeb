<!DOCTYPE html>
<html>
  <head>
    <title>Heatmap Example</title>
    <style>
      #map {
        width: 100%;
        height: 500px;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://openlayers.org/en/v6.5.0/css/ol.css"
      type="text/css"
    />
    <script src="https://openlayers.org/en/v6.5.0/build/ol.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/heatmap.js"></script> -->
  </head>
  <body>
    <div id="map"></div>

    <script>
      // Coordenadas delimitadoras del área
      lonmin = -70.6828;
      latmin = 19.445;
      lonmax = -70.6841;
      latmax = 19.4437;

      var extent = ol.proj.transformExtent(
        [lonmin, latmin, lonmax, latmax],
        "EPSG:4326",
        "EPSG:3857"
      ); // Reemplaza lonmin, latmin, lonmax, latmax con los valores de tus coordenadas de longitud y latitud

      // Datos de ejemplo de temperatura y humedad
      var data = [
        //CAPILLA:
        { lon: -70.6828, lat: 19.445, temperature: 35, humidity: 0.6 },

        //BIBLIOTECA:
        { lon: -70.6841, lat: 19.4437, temperature: 12, humidity: 0.1 },

        //LAB ITT:
        { lon: -70.6827, lat: 19.4412, temperature: 12, humidity: 0.61 },

        //KIOSKO:
        { lon: -70.6843, lat: 19.4416, temperature: 12, humidity: 0.6 },

        //PADRE ARROYO:
        { lon: -70.6847, lat: 19.4423, temperature: 12, humidity: 0.6 },

        //AULAS 4:
        { lon: -70.6834, lat: 19.443, temperature: 12, humidity: 0.6 },

        //PARQUEO GRL:
        { lon: -70.6823, lat: 19.4423, temperature: 12, humidity: 0.6 },

        //JUAN VXIII:
        { lon: -70.6819, lat: 19.4396, temperature: 12, humidity: 0.6 },
        // Agrega más puntos de datos según tus necesidades
      ]; // Reemplaza lon1, lat1, temp1, hum1, etc. con tus valores de longitud, latitud, temperatura y humedad

      // Calcular el centro del área
      var centerLon = (lonmin + lonmax) / 2;
      var centerLat = (latmin + latmax) / 2;

      // Crear el mapa
      var map = new ol.Map({
        target: "map",
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM(),
          }),
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([centerLon, centerLat]),
          zoom: 16,
          maxZoom: 17,
          minZoom: 16,
        }),
      });

      // Crear el heatmap layer
      var heatmapLayer = new ol.layer.Heatmap({
        source: new ol.source.Vector(),
        blur: 25,
        radius: 65,
        gradient: ["green", "lime", "red"],
      });

      // Añadir el heatmap layer al mapa
      map.addLayer(heatmapLayer);

      // Procesar los datos y añadirlos al heatmap layer
      var vectorSource = heatmapLayer.getSource();
      data.forEach(function (d) {
        var feature = new ol.Feature({
          geometry: new ol.geom.Point(ol.proj.fromLonLat([d.lon, d.lat])),
          weight: calculateWeight(d.temperature, d.humidity),
        });
        vectorSource.addFeature(feature);
      });

      // Función para calcular el peso del punto basado en temperatura y humedad
      function calculateWeight(temperature, humidity) {
        var temperatureWeight = 0;
        if (temperature < 20) {
          temperatureWeight = 0.1; // Azul
        } else if (temperature >= 20 && temperature <= 32) {
          temperatureWeight = 0.5; // Verde
        } else {
          temperatureWeight = 0.8; // Naranja
        }

        var humidityWeight = 0;
        if (humidity < 0.5) {
          humidityWeight = 0.8; // Naranja
        } else if (humidity >= 0.5 && humidity <= 0.8) {
          humidityWeight = 0.5; // Verde
        } else {
          humidityWeight = 1.0; // Rojo
        }

        return (temperatureWeight + humidityWeight) / 2;
      }
    </script>
  </body>
</html>
